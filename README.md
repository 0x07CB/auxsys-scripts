# auxsys-scripts

---

> üöß **√âtat du projet : version pr√©liminaire / en cours d'am√©lioration**
>
> Ce d√©p√¥t est **fonctionnel** pour les deux principales fonctionnalit√©s :
> - üå°Ô∏è **Lecture du capteur DHT11** (temp√©rature & humidit√©, vocalisation, installation automatis√©e)
> - üí° **Veilleuse automatique** (gestion de la luminosit√©, alertes sonores, service systemd, installation automatis√©e)
>
> ---
>
> - üìö Documentation d√©taill√©e (installation, configuration mat√©rielle et logicielle, usage)
> - üõ†Ô∏è Scripts d'installation et de configuration (Python, shell, systemd)
> - üîó Gestion des d√©pendances et des groupes syst√®me
> - üîä Assets sonores int√©gr√©s
> - üìÑ Licence MIT
>
> ### üìù Ce qui reste √† am√©liorer ou √† ajouter dans les prochains patchs
> - üß© Finalisation et robustesse de certains scripts shell (ex : gestion d'erreurs, logs, compl√©tion de `setup-pigpio.sh`)
> - üñºÔ∏è Ajout de sch√©mas de branchement mat√©riel
>
> **‚ÑπÔ∏è Le projet est donc publiquement utilisable, mais il reste en √©volution.**

---

> üì¢ **Vous souhaitez contribuer ? Consultez le guide de contribution : [CONTRIBUTING.md](./CONTRIBUTING.md)**

---

# auxsys-scripts
```
scripts-sysaux/
‚îú‚îÄ‚îÄ dht11/
‚îÇ   ‚îú‚îÄ‚îÄ dht.py
‚îÇ   ‚îú‚îÄ‚îÄ espeak-dht11-temperature.sh
‚îÇ   ‚îú‚îÄ‚îÄ install-scripts.sh
‚îÇ   ‚îú‚îÄ‚îÄ install-python-deps.sh
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ light_auto/
‚îÇ   ‚îú‚îÄ‚îÄ install-scripts.sh
‚îÇ   ‚îú‚îÄ‚îÄ light_auto.py
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ light-auto.service
‚îÇ   ‚îî‚îÄ‚îÄ sounds/
‚îÇ       ‚îú‚îÄ‚îÄ alert07.wav
‚îÇ       ‚îî‚îÄ‚îÄ alert08.wav
```

## 1. dht11 : Lecture du capteur DHT11 (temp√©rature & humidit√©)

- **dht.py** : Script Python pour lire les donn√©es du capteur DHT11 via pigpio.
- **espeak-dht11-humidity.sh** / **espeak-dht11-temperature.sh** : Scripts shell pour vocaliser la temp√©rature ou l'humidit√© via espeak-ng.
- **install-scripts.sh** : Installe les scripts, d√©pendances et cr√©e les liens symboliques n√©cessaires.
- **install-python-deps.sh** : Installe les d√©pendances Python avec options d'installation interactive.
- **requirements.txt** : D√©pendances Python n√©cessaires (pigpio, gpiozero, etc).

### Installation (dht11)
### üöÄ Installation ultra-rapide du module DHT11 (temp√©rature & humidit√©)

Pour installer et configurer automatiquement tout le n√©cessaire pour le capteur DHT11 sur votre Raspberry Pi (mod√®les 2, 3, 4), il suffit de copier-coller la ligne suivante dans votre terminal‚ÄØ:

```bash
sudo bash -c 'tmpdir=$(mktemp -d) && git clone --depth=1 https://github.com/0x07CB/auxsys-scripts.git "$tmpdir" && bash "$tmpdir/scripts-sysaux/dht11/remote-install.sh" && rm -rf "$tmpdir"'
```

Cette commande‚ÄØ:
- T√©l√©charge le d√©p√¥t dans un dossier temporaire,
- Installe les d√©pendances requises,
- Configure le service pigpio,
- Installe les scripts et utilitaires pour le DHT11,
- Ajoute l'utilisateur au groupe `gpio` si besoin.

> **Information** : Si le service Remote GPIO √©choue √† d√©marrer correctement apr√®s l'installation, il suffit de red√©marrer l'appareil pour que tout fonctionne normalement avec la configuration et les scripts mis √† jour.

---
```bash
cd scripts-sysaux/dht11
sudo ./install-scripts.sh
```

### Installation des d√©pendances Python (DHT11)

Le script `install-python-deps.sh` vous propose plusieurs modes d'installation :
- **venv local** : cr√©e un environnement virtuel Python dans le dossier courant.
- **utilisateur courant** : installe les paquets pour l'utilisateur actuel.
- **autre utilisateur** : installe pour un utilisateur syst√®me sp√©cifique.

Lancez :
```bash
cd scripts-sysaux/dht11
./install-python-deps.sh
```
et suivez les instructions.

> **Note** : L'installation compl√®te (`install-scripts.sh`) g√®re aussi la copie des scripts, la cr√©ation des liens symboliques, et l'ajout au groupe `audio` si besoin.

### Mise √† jour des scripts

Pour mettre √† jour les scripts, relancez simplement le script d'installation :
```bash
sudo ./install-scripts.sh
```
Les anciens fichiers sont sauvegard√©s avec l'extension `.bak` si besoin.

### Instructions pour connecter le capteur DHT11

Le capteur DHT11 poss√®de trois broches principales :
- **VCC** : √† connecter √† une source d'alimentation 5V ou 3.3V sur le Raspberry Pi.
- **DATA** : √† connecter √† une broche GPIO du Raspberry Pi (par d√©faut GPIO 4).
- **GND** : √† connecter √† une broche de masse (GND) sur le Raspberry Pi.

#### √âtapes pour connecter le capteur DHT11 :
1. Identifiez les broches du capteur DHT11 (VCC, DATA, GND).
2. Connectez la broche **VCC** √† une broche d'alimentation 5V ou 3.3V du Raspberry Pi.
3. Connectez la broche **DATA** √† la broche GPIO 4 (ou une autre broche GPIO compatible, voir encadr√© ci-dessous).
4. Connectez la broche **GND** √† une broche de masse (GND) du Raspberry Pi.
5. Assurez-vous que le d√©mon pigpio est actif sur le Raspberry Pi :
   ```bash
   sudo pigpiod
   ```
6. Testez la connexion en ex√©cutant le script :
   ```bash
   dht11.py --temperature --humidity
   ```

> **Important : Choix de la broche GPIO**
>
> - Le DHT11 peut √™tre connect√© √† n'importe quelle broche GPIO num√©rique du Raspberry Pi (mod√®les 2, 3, 4), √† condition qu'elle ne soit pas d√©j√† utilis√©e par un autre p√©riph√©rique ou une fonction sp√©ciale (I2C, SPI, UART, etc.).
> - Par convention, la broche GPIO 4 (num√©rotation BCM) est souvent utilis√©e, mais ce n'est pas une obligation.
> - **Num√©rotation recommand√©e :** Toutes les instructions et scripts de ce projet utilisent la num√©rotation BCM (Broadcom), qui est la plus courante dans la documentation Raspberry Pi et dans les biblioth√®ques Python (pigpio, gpiozero, etc.).
> - **√Ä √©viter :** N'utilisez pas les broches r√©serv√©es √† l'alimentation (5V/3.3V), √† la masse (GND), ni les broches d√©j√† utilis√©es pour I2C (GPIO 2/3), UART (GPIO 14/15), SPI (GPIO 10/9/11), sauf si vous savez ce que vous faites.
> - **Exemples de GPIO compatibles (num√©rotation BCM) :**
>   - GPIO 4 (par d√©faut)
>   - GPIO 17
>   - GPIO 18
>   - GPIO 27
>   - GPIO 22
>   - GPIO 23
>   - GPIO 24
>   - GPIO 25
> - **Astuce :** Pour √©viter toute confusion, v√©rifiez toujours que vous utilisez la num√©rotation BCM (et non la num√©rotation physique BOARD) dans vos scripts et branchements. La plupart des biblioth√®ques Python utilisent BCM par d√©faut.

> **Note** : Ce script est compatible avec les Raspberry Pi 2, 3 et 4. Il n'a pas encore √©t√© test√© sur le Raspberry Pi 5, mais une adaptation est pr√©vue pour cette plateforme dans le futur.

### Utilisation
- Pour lire la temp√©rature :
  ```bash
  dht11.py --temperature
  ```
- Pour lire l'humidit√© :
  ```bash
  dht11.py --humidity
  ```
- Pour lire temp√©rature et humidit√© (par d√©faut si aucune option n‚Äôest pr√©cis√©e) :
  ```bash
  dht11.py
  ```
- Pour afficher la temp√©rature en Fahrenheit :
  ```bash
  dht11.py --temperature --fahrenheit
  ```
- Pour personnaliser le symbole d‚Äôunit√© (exemple pour Celsius) :
  ```bash
  dht11.py --temperature --custom-celsius-unit="Degr√©s Celsius"
  ```
- Pour personnaliser le symbole d‚Äôunit√© pour Fahrenheit :
  ```bash
  dht11.py --temperature --fahrenheit --custom-fahrenheit-unit="Degr√©s Fahrenheit"
  ```
- Pour personnaliser le symbole d‚Äôunit√© pour l‚Äôhumidit√© :
  ```bash
  dht11.py --humidity --custom-humidity-unit="Pourcents"
  ```
- Pour personnaliser le pr√©fixe d‚Äôaffichage :
  ```bash
  dht11.py --temperature --prefix-temperature="La temp√©rature est de"
  dht11.py --humidity --prefix-humidity="Le taux d\'humidit√© est de"
  ```
- Pour utiliser la sortie standard (stdout) (par d√©faut) :
  ```bash
  dht11.py --temperature --use-stdout
  ```
- Pour supprimer le retour √† la ligne √† la fin de la sortie (utile pour l‚Äôint√©gration dans d‚Äôautres scripts) :
  ```bash
  dht11.py --temperature --no-line-return
  ```
- Pour sp√©cifier la broche GPIO utilis√©e :
  ```bash
  dht11.py --gpio 17
  ```
- Pour sp√©cifier l‚Äôadresse IP et le port du d√©mon pigpio (par d√©faut : 127.0.0.1:8888) :
  ```bash
  dht11.py --host 192.168.1.10 --port 8888
  ```
- Pour afficher la version du script :
  ```bash
  dht11.py --version
  ```
- Pour vocaliser la temp√©rature :
  ```bash
  espeak-dht11-temperature.sh
  ```
- Pour vocaliser l'humidit√© :
  ```bash
  espeak-dht11-humidity.sh
  ```

#### R√©sum√© des options disponibles

| Option                        | Description                                                      | Valeur par d√©faut      |
|-------------------------------|------------------------------------------------------------------|------------------------|
| `--gpio`                      | Num√©ro de la broche GPIO                                         | 4                      |
| `--host`                      | Adresse IP du d√©mon pigpio                                       | 127.0.0.1              |
| `--port`                      | Port du d√©mon pigpio                                             | 8888                   |
| `--humidity`                  | Afficher l‚Äôhumidit√©                                              | -                      |
| `--temperature`               | Afficher la temp√©rature                                          | -                      |
| `--fahrenheit`                | Convertir la temp√©rature en Fahrenheit                           | -                      |
| `--use-stdout`                | Utiliser la sortie standard                                      | True                   |
| `--no-line-return`            | Ne pas ajouter de retour √† la ligne                              | False                  |
| `--custom-celsius-unit`       | Symbole de l‚Äôunit√© Celsius                                       | ¬∞C                     |
| `--custom-fahrenheit-unit`    | Symbole de l‚Äôunit√© Fahrenheit                                    | ¬∞F                     |
| `--custom-humidity-unit`      | Symbole de l‚Äôunit√© d‚Äôhumidit√©                                    | %                      |
| `--prefix-temperature`        | Pr√©fixe pour l‚Äôaffichage de la temp√©rature                       | "temperature: "        |
| `--prefix-humidity`           | Pr√©fixe pour l‚Äôaffichage de l‚Äôhumidit√©                           | "humidity: "           |
| `--version`                   | Afficher la version du script                                    | -                      |

## 2. light_auto : Veilleuse automatique selon la luminosit√©

- **light_auto.py** : Script Python pour contr√¥ler une LED selon la luminosit√© ambiante (capteur + GPIO).
- **install-scripts.sh** : Installe le service systemd, les sons, le script et les d√©pendances.
- **services/light-auto.service** : Fichier de service systemd pour lancer le script au d√©marrage.
- **sounds/** : Sons d'alerte jou√©s lors des changements d'√©tat.
- **requirements.txt** : D√©pendances Python n√©cessaires (pygame, RPi.GPIO).

### üöÄ Installation ultra-rapide du module light_auto (veilleuse)

Pour installer et configurer automatiquement tout le n√©cessaire pour la veilleuse automatique sur votre Raspberry Pi (mod√®les 2, 3, 4), il suffit de copier-coller la ligne suivante dans votre terminal‚ÄØ:

```bash
sudo bash -c 'tmpdir=$(mktemp -d) && git clone --depth=1 https://github.com/0x07CB/auxsys-scripts.git "$tmpdir" && bash "$tmpdir/scripts-sysaux/light_auto/install-scripts.sh" && rm -rf "$tmpdir"'
```

Cette commande‚ÄØ:
- T√©l√©charge le d√©p√¥t dans un dossier temporaire,
- Installe les d√©pendances requises,
- Configure le service systemd,
- Installe les scripts et utilitaires pour la veilleuse,
- Cr√©e l'utilisateur et ajoute aux groupes n√©cessaires (`gpio`, `audio`),
- Nettoie le dossier temporaire √† la fin.

### Installation (light_auto)
```bash
cd scripts-sysaux/light_auto
sudo ./install-scripts.sh
```

### Installation des d√©pendances Python (light_auto)

Le script `install-python-deps.sh` est appel√© automatiquement √† la fin de l'installation, mais vous pouvez aussi le lancer manuellement pour choisir le mode d'installation‚ÄØ:
- **venv local** : cr√©e un environnement virtuel Python dans le dossier courant.
- **utilisateur courant** : installe les paquets pour l'utilisateur actuel.
- **autre utilisateur** : installe pour un utilisateur syst√®me sp√©cifique.

Lancez :
```bash
cd scripts-sysaux/light_auto
./install-python-deps.sh
```
et suivez les instructions.

> **Note** : L'installation compl√®te (`install-scripts.sh`) g√®re aussi la copie des scripts, la cr√©ation des dossiers, et l'ajout au groupe `audio` si besoin.

### Utilisation
- Le service `light-auto` peut √™tre activ√©/d√©sactiv√© via systemd :
  ```bash
  sudo systemctl enable --now light-auto.service
  sudo systemctl status light-auto.service
  ```

## Script d'automatisation de la configuration pigpio

Pour simplifier la pr√©paration de votre syst√®me et garantir le bon fonctionnement des scripts utilisant les GPIO (notamment DHT11), un script d'automatisation est fourni :

- **setup-pigpio.sh** : Ce script automatise l'installation des paquets n√©cessaires (pigpio, python3-pigpio, etc.), l'activation et le d√©marrage du service pigpiod, ainsi que l'ajout de l'utilisateur courant au groupe `gpio` (indispensable pour acc√©der aux GPIO sans droits root). Il affiche un message `[SUCCESS]` en vert √† la fin si tout s'est bien d√©roul√©.

### Utilisation recommand√©e
Avant toute utilisation des scripts DHT11 ou light_auto, ex√©cutez :
```bash
cd scripts-sysaux/dht11
sudo ./setup-pigpio.sh
```
- Si vous n'√™tes pas dans le groupe `gpio`, le script vous y ajoutera automatiquement.
- Si des paquets sont manquants, ils seront install√©s.
- Le service pigpiod sera activ√© et d√©marr√©.

> **Remarque :** Ce script ne modifie pas le fichier `/boot/firmware/config.txt`. Vous devez toujours adapter ce fichier manuellement selon vos branchements mat√©riels (voir section pr√©c√©dente).

## D√©pendances g√©n√©rales
- Python 3
- pigpio, gpiozero, RPi.GPIO, pygame
- espeak-ng, sox
- Un Raspberry Pi avec acc√®s aux GPIO
- **Groupe syst√®me requis :** L'utilisateur courant doit appartenir au groupe `gpio` (g√©r√© automatiquement par `setup-pigpio.sh`).

## Configuration GPIO dans /boot/firmware/config.txt

Pour garantir le bon fonctionnement des scripts d'automatisation (capteur DHT11, capteur de luminosit√©, √©clairage LED), il est n√©cessaire de configurer les broches GPIO au niveau du syst√®me. Depuis les derni√®res versions de Raspberry Pi OS et distributions similaires, cette configuration se fait dans le fichier `/boot/firmware/config.txt`.

### O√π modifier ?

- Le fichier se trouve √† l'emplacement : `/boot/firmware/config.txt`
- Il est accessible depuis le syst√®me principal (avec les droits root) ou en montant la carte SD sur un autre ordinateur.

### Bloc de configuration √† ajouter ou v√©rifier

Ajoutez ou v√©rifiez la pr√©sence du bloc suivant √† la fin du fichier (apr√®s toute configuration existante) :

```ini
[all]
# ECLAIRAGE LED
gpio=23=op,dl

# DHT11 SENSOR
gpio=4=ip

# capteur de luminosite
gpio=27=ip
```

### D√©tail par fonctionnalit√©

#### 1. Capteur DHT11 (Temp√©rature & Humidit√©)
- **Ligne concern√©e :**
  ```ini
  gpio=4=ip
  ```
- **Explication :**
  - Configure la broche GPIO 4 en entr√©e (input) pour le capteur DHT11.
  - Si vous utilisez une autre broche (option `--gpio` dans les scripts), adaptez le num√©ro ici.

#### 2. √âclairage automatique (LED)
- **Ligne concern√©e :**
  ```ini
  gpio=23=op,dl
  ```
- **Explication :**
  - Configure la broche GPIO 23 en sortie (output) et √† l'√©tat bas par d√©faut (dl = drive low) pour piloter la LED d'√©clairage.
  - Si vous changez la broche dans le script d'automatisation, adaptez ici aussi.

#### 3. Capteur de luminosit√©
- **Ligne concern√©e :**
  ```ini
  gpio=27=ip
  ```
- **Explication :**
  - Configure la broche GPIO 27 en entr√©e pour le capteur de luminosit√©.
  - √Ä adapter si vous branchez le capteur sur une autre broche.

### Proc√©dure

1. Ouvrez le fichier `/boot/firmware/config.txt` avec les droits administrateur¬†:
   ```bash
   sudo nano /boot/firmware/config.txt
   ```
2. Ajoutez ou modifiez le bloc ci-dessus selon vos besoins mat√©riels.
3. Enregistrez et quittez l'√©diteur.
4. Red√©marrez le Raspberry Pi pour que la configuration soit prise en compte¬†:
   ```bash
   sudo reboot
   ```

> **Remarque¬†:**
> - Si vous utilisez d'autres broches que celles par d√©faut dans les scripts, pensez √† adapter √† la fois la configuration dans ce fichier et les options de lancement des scripts (`--gpio`).
> - Cette configuration est indispensable pour garantir l'acc√®s correct aux GPIO par les scripts Python et shell du projet.

## Activation et configuration du serveur Remote GPIO (pigpiod)

Pour contr√¥ler les GPIO du Raspberry Pi √† distance (depuis un autre Pi ou un PC), suivez ces √©tapes :

### 1. Installer pigpio et activer le service pigpiod

```bash
sudo apt update
sudo apt install pigpio python3-pigpio
```

### 2. Activer le service pigpiod au d√©marrage

```bash
sudo systemctl enable pigpiod
sudo systemctl start pigpiod
```

- V√©rifiez que le service est actif :
  ```bash
  sudo systemctl status pigpiod
  ```

### 3. (Optionnel) Lancer pigpiod manuellement avec des options r√©seau

Pour autoriser uniquement certaines adresses IP √† acc√©der √† distance :
```bash
sudo pigpiod -n 192.168.1.42
```
(adaptez l‚ÄôIP √† celle de votre contr√¥leur distant)

### 4. Activer le Remote GPIO via raspi-config

```bash
sudo raspi-config
```
- Menu : Interface Options ‚Üí Remote GPIO ‚Üí Enable

### 5. Sur la machine de contr√¥le (PC ou autre Pi)

- Installez les biblioth√®ques n√©cessaires :
  ```bash
  sudo apt install python3-gpiozero python3-pigpio
  ```
  ou via pip :
  ```bash
  pip3 install gpiozero pigpio
  ```

### 6. Utilisation √† distance dans vos scripts Python

- Soit en passant l‚ÄôIP via une variable d‚Äôenvironnement :
  ```bash
  PIGPIO_ADDR=192.168.1.42 python3 mon_script.py
  ```
- Soit en for√ßant la pin factory dans le code :
  ```python
  from gpiozero import LED
  from gpiozero.pins.pigpio import PiGPIOFactory

  factory = PiGPIOFactory(host='192.168.1.42')
  led = LED(17, pin_factory=factory)
  ```

> **Remarque** : Pour utiliser GPIO Zero √† distance, le d√©mon pigpiod doit √™tre actif sur le Raspberry Pi cible, et le port 8888 doit √™tre ouvert sur le r√©seau.

## Licence
MIT License
